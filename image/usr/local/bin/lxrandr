#!/bin/bash
# Configure screen resolution and restart x11vnc

# Author: Xiangmin Jiao <xmjiao@gmail.com>
# Copyright Xiangmin Jiao 2017--2022. All rights reserved.

# Note: For this script to work properly, /usr/local/bin/lxrandr must
# have higher precedence over /usr/bin/lxrandr in the path.

OLD_RESOLUT=$(xrandr -q | grep connected | cut --delimiter " " -f 3)

/usr/bin/lxrandr

NEW_RESOLUT=$(xrandr -q | grep connected | cut --delimiter " " -f 3)

# If resolution changes, kill x11vnc so that it can be restarted in startvnc.sh
if [ "$OLD_RESOLUT" != "$NEW_RESOLUT" ]; then
    touch $HOME/.log/restart_x11vnc_X$DISP
    kill $(cat $HOME/.log/x11vnc_X${DISPLAY//:0/}_pid)
fi
